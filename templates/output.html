<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard | StressSense AI</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    body { 
      font-family: 'Inter', sans-serif; 
      background-color: #f5f6fa; 
    }
    .sidebar { 
      height: 100vh; 
      background: #2c3e50; 
      color: white; 
      padding-top: 20px;
    }
    .sidebar a { 
      color: white; 
      text-decoration: none; 
      display: block; 
      padding: 12px 20px; 
      border-radius: 8px;
      margin: 2px 10px;
    }
    .sidebar a:hover { background: #34495e; }
    .sidebar .active { background: #1abc9c; }
    .content { padding: 30px; }
    .card { border-radius: 12px; }
    .card h6 { color: #1abc9c; margin-top: 15px; }
    .card p { margin-bottom: 8px; }
    .card ul { padding-left: 20px; margin-bottom: 10px; }
    .card li { margin-bottom: 4px; }
  </style>
</head>
<body>

<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-2 sidebar d-none d-md-block">
      <h3 class="text-center mb-3">StressSense AI</h3>
      <a href="{{ url_for('user.dashboard') }}" class="active"><i class="bi bi-house-fill me-2"></i> Dashboard</a>
      <a href="{{ url_for('user.profile') }}"><i class="bi bi-person-fill me-2"></i> Profile</a>
      <a href="{{ url_for('user.assessments') }}"><i class="bi bi-bar-chart-fill me-2"></i> Assessments</a>
      <a href="{{ url_for('user.suggestions') }}"><i class="bi bi-lightbulb-fill me-2"></i> Suggestions</a>
      <a href="{{ url_for('user.output') }}"><i class="bi bi-lightbulb-fill me-2"></i> Output</a>
      <a href="{{ url_for('user.logout') }}"><i class="bi bi-box-arrow-right me-2"></i> Logout</a>
    </div>

    <!-- Main Content -->
    <div class="col-md-10 content">
      <h2 class="mb-4">Your Assignments</h2>
      <div id="assignmentsContainer"></div>
    </div>
  </div>
</div>

<script>
const userId = "{{ user._id }}";

async function fetchAssignments() {
  const container = document.getElementById("assignmentsContainer");
  try {
    const res = await fetch(`/get-assignments/${userId}`);
    const data = await res.json();
    container.innerHTML = "";

    if (!data || data.length === 0) {
      container.innerHTML = "<p>No assignments submitted yet.</p>";
      return;
    }

    data.forEach((assignment, index) => {
      const card = document.createElement("div");
      card.className = "card shadow-sm p-4 mb-4";

      let html = `<h5 class="mb-3">Assignment ${index + 1}</h5>`;
      html += `<p><strong>Started At:</strong> ${new Date(assignment.startedAt).toLocaleString()}</p>`;
      html += `<p><strong>Completed At:</strong> ${assignment.completedAt ? new Date(assignment.completedAt).toLocaleString() : "Not completed"}</p>`;

      if (assignment.categories && assignment.categories.length > 0) {
        assignment.categories.forEach(cat => {
          let catHtml = `<h6>${cat.categoryName}</h6>`;
          let questionsHtml = "";

          cat.questions.forEach(q => {
            if (q.answer && q.answer.trim() !== "") {
              questionsHtml += `<p><strong>Q:</strong> ${q.question}</p>`;
              questionsHtml += `<p><strong>Answer:</strong> ${q.answer}</p>`;

              // Display prediction object as a list
              if (q.prediction && typeof q.prediction === "object") {
                questionsHtml += `<p><strong>Prediction:</strong></p><ul>`;
                for (const key in q.prediction) {
                  if (q.prediction.hasOwnProperty(key)) {
                    questionsHtml += `<li><strong>${key}:</strong> ${q.prediction[key]}</li>`;
                  }
                }
                questionsHtml += `</ul>`;
              }
            }
          });

          if (questionsHtml !== "") {
            catHtml += questionsHtml;
            html += catHtml;
          }
        });
      }

      card.innerHTML = html;
      container.appendChild(card);
    });

  } catch (err) {
    container.innerHTML = `<p class="text-danger">Failed to fetch assignments: ${err.message}</p>`;
  }
}

fetchAssignments();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>


